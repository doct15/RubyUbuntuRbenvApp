bmcgehee/RubyUbuntuRbenvApp:
  # This Basic Distelli Manifest assumes the following
  # has been provisioned on the destination deploy server:
  #
  # OS: Ubuntu
  #
  
  Env:
    - PORT: 8007
    - STAGE: production
    
  PreInstall:
    - echo "Begin PreInstall"
    - sudo apt-get -y update
    - echo "update done"
    - sudo apt-get -y install git curl zlib1g-dev build-essential libssl-dev libreadline-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libxslt1-dev libcurl4-openssl-dev python-software-properties libffi-dev
    - echo "===== beginning git clone ====="
    - git clone git://github.com/sstephenson/rbenv.git ~/.rbenv
    - echo "===== begining export ====="
    #- pwd
    #- env
    - echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bash_profile
    - export PATH="$HOME/.rbenv/bin:$PATH"
    - echo "===== beginning eval ====="
    #- pwd
    #- env
    - echo 'eval "$(rbenv init -)"' >> ~/.bash_profile
    - eval "$(rbenv init -)"
    - git clone git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
    - echo 'export PATH="$HOME/.rbenv/plugins/ruby-build/bin:$PATH"' >> ~/.bash_profile
    - export PATH="$HOME/.rbenv/plugins/ruby-build/bin:$PATH"
    - rbenv install -v 1.9.3-p551
    - rbenv global 1.9.3-p551
    - ruby -v
    - eval "$(rbenv init -)"
    - gem install bundler
    - eval "$(rbenv init -)"
    
  Exec: 
    - exec ./bundle/bin/thin start -p $PORT -e $STAGE
    
  PostInstall:
    - echo "begin PostInstall"
    - eval "$(rbenv init -)"
    - bundle install --binstubs $DISTELLI_APPHOME/bundle/bin --standalone --path $DISTELLI_APPHOME/bundle/lib
    - echo "done PostInstall"
    
  PkgInclude:
    - lib/simplerubyapp/*.rb
    - Gemfile
    - config.ru
    - SimpleRubyApp.gemspec
